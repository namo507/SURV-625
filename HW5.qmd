---
title: "Homework 5: Namit Shrivastava"
format: pdf
editor: visual
---

## 1. The following is the distribution of occupied housing units and blocks for two counties in  Michigan.  A stratified PPeS sample of n = 3000 housing units in a = 100 blocks with  minimum sufficient size b* per block is to be selected across the counties. The counties and the subdivisions within each county of river and non-river blocks serve as four (4) strata.

## a) Allocate the sample blocks across the four strata proportionate to occupied housing units. How have you handled rounding of sample blocks?

The proportionate allocation formula is:

$$n_h = a \times \frac{N_h}{N}$$

Where:

$n_h$ is the number of sample blocks allocated to stratum $h$
$a = 100$ is the total number of sample blocks to be selected
$N_h$ is the number of occupied housing units in stratum $h$
$N$ is the total number of occupied housing units
For each stratum:

$$n_1 = 100 \times \frac{8,521}{131,788} = 100 \times 0.0647 = 6.47$$

$$n_2 = 100 \times \frac{28,744}{131,788} = 100 \times 0.2181 = 21.81$$

$$n_3 = 100 \times \frac{17,224}{131,788} = 100 \times 0.1307 = 13.07$$

$$n_4 = 100 \times \frac{77,299}{131,788} = 100 \times 0.5866 = 58.66$$

Rounding to whole numbers:

Allegan_River: 6.47 -> 6
Allegan_NonRiver: 21.81 -> 22
Kalamazoo_River: 13.07 -> 13
Kalamazoo_NonRiver: 58.66 -> 59
The sum is 6 + 22 + 13 + 59 = 100, which equals our target.


So the R code for this is:

```{r}
# Creating data frame for the four strata
strata_data <- data.frame(
  stratum = c("Allegan_River", "Allegan_NonRiver", "Kalamazoo_River", "Kalamazoo_NonRiver"),
  occupied_units = c(8521, 37265-8521, 17224, 94523-17224),
  blocks = c(940, 3593-940, 1318, 4494-1318)
)

# Calculating total number of occupied housing units
strata_data$nonriver_units <- c(37265-8521, 0, 94523-17224, 0)
strata_data$occupied_units <- c(8521, 37265-8521, 17224, 94523-17224)

strata_data <- data.frame(
  stratum = c("Allegan_River", "Allegan_NonRiver", "Kalamazoo_River", "Kalamazoo_NonRiver"),
  occupied_units = c(8521, 37265-8521, 17224, 94523-17224),
  blocks = c(940, 3593-940, 1318, 4494-1318)
)

print(strata_data)
```

Now let me allocate the 100 sample blocks proportionate to occupied housing units:

```{r}
# Total number of sample blocks
total_sample_blocks <- 100

# Calculating total occupied housing units
total_occupied <- sum(strata_data$occupied_units)

# Calculating proportionate allocation
strata_data$proportion <- strata_data$occupied_units / total_occupied
strata_data$initial_allocation <- strata_data$proportion * total_sample_blocks
strata_data$fractional_part <- strata_data$initial_allocation - floor(strata_data$initial_allocation)
strata_data$rounded_allocation <- round(strata_data$initial_allocation)

# Checking if sum equals target
sum_allocations <- sum(strata_data$rounded_allocation)

if (sum_allocations != total_sample_blocks) {
  cat("Adjustments needed: Sum =", sum_allocations, "Target =", total_sample_blocks, "\n")
  
  # Adjusting based on fractional parts
  difference <- total_sample_blocks - sum_allocations
  
  if (difference > 0) {
    # Adding blocks to strata with largest fractional parts not rounded up
    order_candidates <- order(strata_data$fractional_part, decreasing = TRUE)
    for (i in seq_len(difference)) {
      strata_data$rounded_allocation[order_candidates[i]] <- 
        strata_data$rounded_allocation[order_candidates[i]] + 1
    }
  } else if (difference < 0) {
    # Removing blocks from strata with smallest fractional parts that were rounded up
    order_candidates <- order(strata_data$fractional_part)
    for (i in seq_len(abs(difference))) {
      strata_data$rounded_allocation[order_candidates[i]] <- 
        strata_data$rounded_allocation[order_candidates[i]] - 1
    }
  }
}
```

```{r}
print(strata_data[, c("stratum", "occupied_units", "proportion", 
                      "initial_allocation", "rounded_allocation")])
```

Now based on my calculations, I allocated the 100 sample blocks proportionately across the four strata using the number of occupied housing units in each stratum. 

Allegan River, with 8,521 occupied units, was allocated 6 blocks, while Allegan Non-River, which has 28,744 occupied units, received 22 blocks. Kalamazoo River, with 17,224 occupied units, was assigned 13 blocks, and Kalamazoo Non-River, the largest stratum with 77,299 occupied units, was allocated 59 blocks. 

These allocations were rounded from their initial fractional values to ensure the total number of blocks summed exactly to 100.