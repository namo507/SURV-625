---
title: "Homework 2: Namit Shrivastava"
format: pdf
editor: visual
---

## 1. A stratified random sample of graduates from the academic departments at a small university is to be selected to estimate the mean starting salary of graduates from that university. The university has five academic departments, and preliminary data are obtained from an attempted census in a recent year:

| Stratum | Department | $N_h$ | $\bar{Y}_h$ | $S_h$ |
|:--------|:-----------|:-----:|------------:|------:|
| 1 | Humanities | 20 | 46,800 | 81,200 |
| 2 | Social Sciences | 90 | 61,500 | 101,700 |
| 3 | Natural Sciences | 120 | 76,100 | 130,900 |
| 4 | Engineering | 140 | 89,500 | 170,100 |
| 5 | Business | 200 | 95,500 | 216,400 |

## a) Now what is What is the mean starting salary per graduate across all departments in the $\bar{Y}_h$ population, based on the data collected from this previous attempted census?

The overall mean salary $\bar{Y}$ is calculated as:

$$\bar{Y} = \frac{\sum_{h=1}^{H} N_h\bar{Y}_h}{\sum_{h=1}^{H} N_h}$$

$$\begin{aligned}
\bar{Y} &= \frac{(20 \times 46,800) + (90 \times 61,500) + (120 \times 76,100) + (140 \times 89,500) + (200 \times 95,500)}{20 + 90 + 120 + 140 + 200} \\
&= \frac{936,000 + 5,535,000 + 9,132,000 + 12,530,000 + 19,100,000}{570} \\
&= \frac{47,233,000}{570}
\end{aligned}
\bar{Y} = 82864.91
$$
The R code for this:

```{r}
# Defining the data
strata <- c(1, 2, 3, 4, 5)
departments <- c("Humanities", "Social Sciences", "Natural Sciences", "Engineering", "Business")
Nh <- c(20, 90, 120, 140, 200)
Yh_bar <- c(46800, 61500, 76100, 89500, 95500)

# Calculating Nh * Yh_bar for each stratum
Nh_Yh_bar <- Nh * Yh_bar

# Calculating the overall mean
Y_bar <- sum(Nh_Yh_bar) / sum(Nh)

cat("The mean starting salary per graduate across all departments is $", round(Y_bar, 2), "\n")
```

## b) What is the average within-stratum element variance ?

The average within-stratum element variance $S^2_w$ is calculated as:

$$S^2_w = \sum_{h=1}^{H} W_h S^2_h$$

where:
- $W_h = N_h/N$ is the stratum weight
- $S^2_h$ is the element variance in stratum $h$
- $H = 5$ departments

$$\begin{aligned}
S^2_w &= \sum_{h=1}^{5} \frac{N_h}{N} S^2_h \\
&= \frac{20}{570}(81,200)^2 + \frac{90}{570}(101,700)^2 + \frac{120}{570}(130,900)^2 + \frac{140}{570}(170,100)^2 + \frac{200}{570}(216,400)^2
\end{aligned}
$$

Now The R code for this will be:
```{r}
# Defining the data
Nh <- c(20, 90, 120, 140, 200)
Sh <- c(81200, 101700, 130900, 170100, 216400)

# Calculating total population size
N <- sum(Nh)

# Calculating stratum weights
Wh <- Nh / N

# Calculating S^2_h
S2h <- Sh^2

# Calculating S^2_w
S2w <- sum(Wh * S2h)

cat("The average within-stratum element variance (S^2_w) is:", S2w, "\n")
```

So this value represents the weighted average of the variances within each stratum, giving us an overall measure of the variability within the strata of the population.

## c) For a sample of n = 100, what is the proportionate allocation?
For $n = 100$, the proportionate allocation is given by:

$$n_h = n \times \frac{N_h}{N}$$

where:
- $n_h$ is the sample size for stratum $h$
- $n = 100$ is the total sample size
- $N_h$ is the population size of stratum $h$
- $N$ is the total population size

```{r}
# Defining the data
Nh <- c(20, 90, 120, 140, 200)
n <- 100

# Calculating total population size
N <- sum(Nh)

# Calculating proportionate allocation
n_prop <- n * (Nh / N)

print(round(n_prop, 2))
```
Hence, the proportionate allocation for n = 100 is:
Humanities: 3.51
Social Sciences: 15.79
Natural Sciences: 21.05
Engineering: 24.56
Business: 35.09

## d) For a sample of n = 100, what is the Neyman allocation?

The Neyman allocation is given by:

$$n_h = n \times \frac{N_h S_h}{\sum_{h=1}^{H} N_h S_h}$$

where:
- $n_h$ is the sample size for stratum $h$
- $n = 100$ is the total sample size
- $N_h$ is the population size of stratum $h$
- $S_h$ is the standard deviation of stratum $h$
- $H = 5$ is the number of strata

```{r}
# Defining the data
Nh <- c(20, 90, 120, 140, 200)
Sh <- c(81200, 101700, 130900, 170100, 216400)
n <- 100

# Calculating Neyman allocation
Nh_Sh <- Nh * Sh
n_neyman <- n * (Nh_Sh / sum(Nh_Sh))

print(round(n_neyman, 2))
```
Hence, the Neyman allocation for n = 100 is:
Humanities: 1.74
Social Sciences: 9.78
Natural Sciences: 16.79
Engineering: 25.45
Business: 46.25

## e) Estimate the sampling variance of the mean for the proportionate c) and Neyman d) allocations.

The sampling variance of the mean for stratified random sampling is:

$$V(\bar{y}_{st}) = \sum_{h=1}^{H} (\frac{N_h}{N})^2 (\frac{1}{n_h} - \frac{1}{N_h}) S_h^2$$

For Proportionate Allocation:

$$\begin{aligned}
V(\bar{y}_{prop}) &= \sum_{h=1}^{H} W_h^2 (\frac{1}{n_h} - \frac{1}{N_h}) S_h^2 \\
&= \frac{1}{n}(1-f)\sum_{h=1}^{H} W_h S_h^2
\end{aligned}$$

$$\begin{aligned}
V(\bar{y}_{prop}) &= \frac{1}{100}(1-\frac{100}{570})\sum_{h=1}^{5} W_h S_h^2 \\
&= \frac{1}{100}(0.825)\sum_{h=1}^{5} \frac{N_h}{570} S_h^2 \\
&= 0.00825 \times [(20/570)(81,200)^2 + (90/570)(101,700)^2 + \\
&\quad (120/570)(130,900)^2 + (140/570)(170,100)^2 + (200/570)(216,400)^2]
\end{aligned}$$

For Neyman Allocation:
$$V(\bar{y}_{neyman}) = \frac{(\sum_{h=1}^{H} N_h S_h)^2}{n N^2}(1-f)$$
$$\begin{aligned}
V(\bar{y}_{neyman}) &= \frac{(20 \times 81,200 + 90 \times 101,700 + 120 \times 130,900 + 140 \times 170,100 + 200 \times 216,400)^2}{100 \times 570^2}(0.825)
\end{aligned}
$$

```{r}
# Data
Nh <- c(20, 90, 120, 140, 200)
Sh <- c(81200, 101700, 130900, 170100, 216400)
n <- 100
N <- sum(Nh)

# Calculating weights
Wh <- Nh / N

# Calculating variance for proportionate allocation
V_prop <- sum(Wh * Sh^2) / n

cat("Sampling variance for proportionate allocation:", V_prop, "\n")
```

```{r}
# Calculate variance for Neyman allocation
V_neyman <- (sum(Wh * Sh))^2 / n

cat("Sampling variance for Neyman allocation:", V_neyman, "\n")
```

```{r}
efficiency_ratio <- V_neyman / V_prop

cat("Efficiency ratio (Neyman / Proportionate):", efficiency_ratio, "\n")
```

## f) Estimate the total element variance S^2
The total element variance $S^2$ is the sum of within-stratum and between-stratum variance:

$$S^2 = \sum_{h=1}^{H} W_h S^2_h + \sum_{h=1}^{H} W_h(\bar{Y}_h - \bar{Y})^2$$

Where:
- Within-stratum: $\sum_{h=1}^{H} W_h S^2_h$
- Between-stratum: $\sum_{h=1}^{H} W_h(\bar{Y}_h - \bar{Y})^2$
```{r}
# Data
Nh <- c(20, 90, 120, 140, 200)
Yh <- c(46800, 61500, 76100, 89500, 95500)
Sh <- c(81200, 101700, 130900, 170100, 216400)
N <- sum(Nh)
Wh <- Nh/N

# Calculate overall mean
Y_bar <- sum(Wh * Yh)

# Within-stratum variance
S2_within <- sum(Wh * Sh^2)

# Between-stratum variance
S2_between <- sum(Wh * (Yh - Y_bar)^2)

# Total element variance
S2_total <- S2_within + S2_between

# Results
c(S2_within, S2_between, S2_total)
```

## g) What are the design effects of the proportionate and Neyman allocations? based on the results?

So the design effect (DEFF) is the ratio of the variance of a stratified design to that of simple random sampling:

$$DEFF = \frac{V(\bar{y}_{st})}{V(\bar{y}_{srs})}$$

where:
- $V(\bar{y}_{st})$ is the variance under stratified sampling
- $V(\bar{y}_{srs}) = (\frac{S^2}{n})(1-f)$ is the variance under SRS
- $S^2$ is the total element variance 
- $f = n/N$ is the sampling fraction

```{r}
# Given data
Nh <- c(20, 90, 120, 140, 200)
Yh_bar <- c(46800, 61500, 76100, 89500, 95500)
Sh <- c(81200, 101700, 130900, 170100, 216400)
n <- 100

# Calculate weights
N <- sum(Nh)
Wh <- Nh / N

# Calculate overall mean
Y_bar <- sum(Wh * Yh_bar)

# Calculate total element variance (S^2)
S2 <- sum(Wh * Sh^2) + sum(Wh * (Yh_bar - Y_bar)^2)

# Variance of SRS
V_SRS <- S2 / n

# Proportionate allocation
n_prop <- n * (Nh / N)
V_prop <- sum(Wh^2 * (Sh^2 / n_prop - Sh^2 / Nh))

# Neyman allocation
n_neyman <- n * (Nh * Sh) / sum(Nh * Sh)
V_neyman <- (sum(Wh * Sh))^2 / n

# Calculate DEFF
DEFF_prop <- V_prop / V_SRS
DEFF_neyman <- V_neyman / V_SRS

# Print results
cat("DEFF for proportionate allocation:", DEFF_prop, "\n")
cat("DEFF for Neyman allocation:", DEFF_neyman, "\n")
```

Ok so both the proportionate and Neyman allocations have design effects less than 1. It means they're both more efficient than simple random sampling. The proportionate allocation has a DEFF of about 0.82, while the Neyman allocation's DEFF is around 0.92. In simpler terms, the proportionate allocation is reducing the variance by about 18% compared to simple random sampling, while the Neyman allocation is reducing it by about 8%.

This suggests that for this particular population structure, the simpler proportionate allocation method is actually more effective at improving precision than the more complex Neyman allocation. It's a good reminder that sometimes, simpler methods can outperform more sophisticated ones depending on the specific characteristics of the data we're working with (Occam's Razor!)

